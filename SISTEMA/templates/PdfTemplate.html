<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Reporte de Gestión</title>
    <style>
        @page {
            size: letter portrait;
            margin: 1.5cm; /* Margen un poco más pequeño para que quepa más info */
            @frame footer_frame {
                -pdf-frame-content: footerContent;
                bottom: 1cm;
                margin-left: 1.5cm;
                margin-right: 1.5cm;
                height: 1cm;
            }
        }
        
        body { font-family: Helvetica, Arial, sans-serif; font-size: 9pt; color: #333; } /* Fuente un poco más chica */
        
        .header { text-align: center; border-bottom: 2px solid #444; padding-bottom: 10px; margin-bottom: 20px; }
        .header h1 { margin: 0; font-size: 16pt; color: #2c3e50; }
        .header p { margin: 5px 0 0 0; color: #666; font-size: 9pt; }

        .vendedor-section { margin-top: 20px; page-break-inside: avoid; }
        .vendedor-title { 
            background-color: #f2f2f2; 
            padding: 6px; 
            font-size: 11pt; 
            font-weight: bold; 
            border-left: 6px solid #0d6efd; 
            color: #000;
        }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background-color: #343a40; color: #fff; padding: 5px; text-align: left; font-size: 8pt; }
        td { border-bottom: 1px solid #ddd; padding: 5px; vertical-align: top; font-size: 8pt; }
        
        .badge-si { color: #198754; font-weight: bold; }
        .badge-no { color: #dc3545; font-weight: bold; }
        
        .prod-list { font-size: 7.5pt; color: #555; font-style: italic; }

        #footerContent { text-align: right; font-size: 8pt; color: #aaa; border-top: 1px solid #eee; padding-top: 5px; }
    </style>
</head>
<body>

    <div class="header">
        <h1>Reporte de Gestión de Vendedores</h1>
        <p>Rango de Fechas: <strong>{{ f_inicio }}</strong> al <strong>{{ f_termino }}</strong></p>
    </div>

    {% for item in data_reporte %}
        <div class="vendedor-section">
            <div class="vendedor-title">
                VENDEDOR: {{ item.vendedor.username|upper }}
            </div>

            <table>
                <thead>
                    <tr>
                        <th width="12%">Fecha</th>
                        <th width="18%">Cliente</th>
                        <th width="15%">Comercio</th>
                        <th width="20%">Productos</th> <th width="8%">Venta</th>
                        <th width="27%">Nota / Detalle</th>
                    </tr>
                </thead>
                <tbody>
                    {% for rep in item.reportes %}
                    <tr>
                        <td>{{ rep.fecha_ingreso|date:"d/m H:i" }}</td>
                        <td>
                            {{ rep.cliente.nombre }} {{ rep.cliente.apellido }}
                        </td>
                        <td>
                            {{ rep.cliente.nombre_comercio|default:"-" }}
                        </td>
                        
                        <td>
                            <div class="prod-list">
                            {% for prod in rep.tipo_producto.all %}
                                • {{ prod.nombre }}<br>
                            {% empty %}
                                -
                            {% endfor %}
                            </div>
                        </td>

                        <td>
                            {% if rep.venta_realizada %}
                                <span class="badge-si">SÍ</span>
                            {% else %}
                                <span class="badge-no">NO</span>
                            {% endif %}
                        </td>
                        <td>
                            {{ rep.descripcion|truncatechars:80 }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            <div style="text-align: right; margin-top: 5px; font-size: 8pt; font-style: italic;">
                Registros: {{ item.reportes.count }}
            </div>
        </div>
    {% empty %}
        <div style="text-align: center; margin-top: 50px; color: #777;">
            <h3>No se encontraron registros para el rango seleccionado.</h3>
        </div>
    {% endfor %}

    <div id="footerContent">
        Generado por: {{ user.username|title }} | Fecha: {% now "d/m/Y H:i" %}
    </div>

</body>
</html>